🔑 Gemini API key provided: AIzaSyB5Gx...
🔧 Gemini Configuration: {
  temperature: 0.7,
  topK: 40,
  topP: 0.9,
  maxOutputTokens: 80,
  envValue: '80'
}
Gemini configured with temperature: 0.7
Gemini service initialized successfully
Twilio service initialized successfully
FUB service initialized successfully
Conversation service initialized successfully
Auth service initialized successfully
Bull queues initialized successfully
Queue processors initialized
🛠️ Dev mode auto-enabled for Test Lead 470
Eugenia Backend server is running on http://localhost:3001
Queue monitoring available at http://localhost:3001/api/queues/stats
Prompts loaded successfully
GET /api/leads endpoint: Attempting to fetch real leads from FUB
GET /api/leads endpoint: Attempting to fetch real leads from FUB
Successfully fetched 100 leads from FUB.
Successfully fetched 100 leads from FUB.

📱 FRONTEND REQUESTING CONVERSATION for lead 470...
   Lead name: Test Everitt
Message Storage initialized with limit: 200 messages
📥 Fetching messages from notes storage for lead 470...
Raw notes from FUB (first 200 chars): [EUGENIA_MESSAGES_START]{"conversations":[{"id":"msg_1750389343354_qcf07d2hh","direction":"inbound","type":"sms","content":"hello","timestamp":"2025-06-20T03:15:43.118Z","fubLogged":false},{"id":"msg_
Parsed 6 messages from notes
   Total messages in storage: 6
   Returning 6 messages to frontend
📝 Storing incoming message in FUB notes for lead 470...
Updating notes for lead 470, size: 1223 chars
First 200 chars of notes: [EUGENIA_MESSAGES_START]{"conversations":[{"id":"msg_1750389343354_qcf07d2hh","direction":"inbound","type":"sms","content":"hello","timestamp":"2025-06-20T03:15:43.118Z","fubLogged":false},{"id":"msg_
Update response: Success
✅ Incoming message stored in FUB notes
Logging inbound SMS to FUB for lead 470: hey
Successfully logged SMS to FUB: 3293
Successfully logged inbound SMS to FUB for lead 470
Eugenia status for lead 470: active
🧠 Building complete context for lead 470...
📥 Fetching messages from notes storage for lead 470...
Raw notes from FUB (first 200 chars): [EUGENIA_MESSAGES_START]{"conversations":[{"id":"msg_1750389343354_qcf07d2hh","direction":"inbound","type":"sms","content":"hello","timestamp":"2025-06-20T03:15:43.118Z","fubLogged":false},{"id":"msg_
Parsed 7 messages from notes
   Total messages in storage: 7
📚 Using FUB history: 7 messages
🎯 Final context: 7 messages for lead Test Everitt
📊 Qualification Progress: 0/3 questions answered
📊 Generating AI reply with context:
    - Lead: Test Everitt (ID: 470)
    - First Name: Test
    - Conversation Messages: 7
    - Qualification Complete: false
📝 Prompt built, length: 1572
📝 First 500 chars of prompt: You are Eugenia, an expert Inside Sales Agent (ISA) for Your Awesome Realty, a real estate company. Your goal is to qualify leads and schedule appointments with agents.

🎯 YOUR PRIMARY OBJECTIVES:
1. Build rapport and trust quickly
2. Identify their timeline and motivation
3. Understand their property needs (location, price, type)
4. Schedule a call or meeting with an agent
5. Keep responses under 160 characters for SMS

📋 LEAD INFORMATION:
- Name: Test Everitt
- Source: <unspecified>
- Tags: 
📝 Last 500 chars of prompt: ces, reference them
5. Move the conversation forward toward scheduling
6. No emojis in responses

🚨 ESCALATION AWARENESS:
- This is message #8 from the lead
- After 3 messages, focus on scheduling a call
- If they mention "call", "schedule", "agent", or show buying urgency, prioritize handoff

📝 RESPONSE GUIDELINES:
- Acknowledge their message first
- Ask ONE qualifying question OR suggest next step
- Keep it natural and conversational
- Under 160 characters total

Generate Eugenia's response:
🧠 Sending prompt to Gemini...
📊 Raw result object: { hasResponse: true, resultKeys: [ 'response' ] }
📊 Response object: {
  hasText: true,
  responseKeys: [
    'candidates',
    'usageMetadata',
    'modelVersion',
    'responseId',
    'text',
    'functionCall',
    'functionCalls'
  ],
  candidates: 1
}
🔍 Candidate details: {
  finishReason: 'MAX_TOKENS',
  hasSafetyRatings: false,
  safetyRatings: undefined,
  hasContent: true,
  contentParts: 0
}
✅ Gemini response received: { responseLength: 0, firstChars: '' }
🔍 AI Generation Result: {
  hasResult: true,
  hasMessage: false,
  messageLength: 0,
  shouldPause: false,
  isQualificationComplete: false
}
⚠️ No AI message generated!
GET /api/leads endpoint: Attempting to fetch real leads from FUB
Successfully fetched 100 leads from FUB.
GET /api/leads endpoint: Attempting to fetch real leads from FUB

📱 FRONTEND REQUESTING CONVERSATION for lead 470...
   Lead name: Test Everitt
📥 Fetching messages from notes storage for lead 470...
Successfully fetched 100 leads from FUB.
Raw notes from FUB (first 200 chars): [EUGENIA_MESSAGES_START]{"conversations":[{"id":"msg_1750389343354_qcf07d2hh","direction":"inbound","type":"sms","content":"hello","timestamp":"2025-06-20T03:15:43.118Z","fubLogged":false},{"id":"msg_
Parsed 7 messages from notes
   Total messages in storage: 7
   Returning 7 messages to frontend
📝 Storing incoming message in FUB notes for lead 470...
Updating notes for lead 470, size: 1374 chars
First 200 chars of notes: [EUGENIA_MESSAGES_START]{"conversations":[{"id":"msg_1750389343354_qcf07d2hh","direction":"inbound","type":"sms","content":"hello","timestamp":"2025-06-20T03:15:43.118Z","fubLogged":false},{"id":"msg_
Update response: Success
✅ Incoming message stored in FUB notes
Logging inbound SMS to FUB for lead 470: hey again
Successfully logged SMS to FUB: 3294
Successfully logged inbound SMS to FUB for lead 470
Eugenia status for lead 470: active
🧠 Building complete context for lead 470...
📥 Fetching messages from notes storage for lead 470...
Raw notes from FUB (first 200 chars): [EUGENIA_MESSAGES_START]{"conversations":[{"id":"msg_1750389343354_qcf07d2hh","direction":"inbound","type":"sms","content":"hello","timestamp":"2025-06-20T03:15:43.118Z","fubLogged":false},{"id":"msg_
Parsed 8 messages from notes
   Total messages in storage: 8
📚 Using FUB history: 8 messages
🎯 Final context: 8 messages for lead Test Everitt
📊 Qualification Progress: 0/3 questions answered
📊 Generating AI reply with context:
    - Lead: Test Everitt (ID: 470)
    - First Name: Test
    - Conversation Messages: 8
    - Qualification Complete: false
📝 Prompt built, length: 1602
📝 First 500 chars of prompt: You are Eugenia, an expert Inside Sales Agent (ISA) for Your Awesome Realty, a real estate company. Your goal is to qualify leads and schedule appointments with agents.

🎯 YOUR PRIMARY OBJECTIVES:
1. Build rapport and trust quickly
2. Identify their timeline and motivation
3. Understand their property needs (location, price, type)
4. Schedule a call or meeting with an agent
5. Keep responses under 160 characters for SMS

📋 LEAD INFORMATION:
- Name: Test Everitt
- Source: <unspecified>
- Tags: 
📝 Last 500 chars of prompt: ces, reference them
5. Move the conversation forward toward scheduling
6. No emojis in responses

🚨 ESCALATION AWARENESS:
- This is message #9 from the lead
- After 3 messages, focus on scheduling a call
- If they mention "call", "schedule", "agent", or show buying urgency, prioritize handoff

📝 RESPONSE GUIDELINES:
- Acknowledge their message first
- Ask ONE qualifying question OR suggest next step
- Keep it natural and conversational
- Under 160 characters total

Generate Eugenia's response:
🧠 Sending prompt to Gemini...
📊 Raw result object: { hasResponse: true, resultKeys: [ 'response' ] }
📊 Response object: {
  hasText: true,
  responseKeys: [
    'candidates',
    'usageMetadata',
    'modelVersion',
    'responseId',
    'text',
    'functionCall',
    'functionCalls'
  ],
  candidates: 1
}
🔍 Candidate details: {
  finishReason: 'MAX_TOKENS',
  hasSafetyRatings: false,
  safetyRatings: undefined,
  hasContent: true,
  contentParts: 0
}
✅ Gemini response received: { responseLength: 0, firstChars: '' }
🔍 AI Generation Result: {
  hasResult: true,
  hasMessage: false,
  messageLength: 0,
  shouldPause: false,
  isQualificationComplete: false
}
⚠️ No AI message generated!
GET /api/leads endpoint: Attempting to fetch real leads from FUB
GET /api/leads endpoint: Attempting to fetch real leads from FUB
Successfully fetched 100 leads from FUB.
Successfully fetched 100 leads from FUB.

📱 FRONTEND REQUESTING CONVERSATION for lead 470...
   Lead name: Test Everitt
📥 Fetching messages from notes storage for lead 470...
Raw notes from FUB (first 200 chars): [EUGENIA_MESSAGES_START]{"conversations":[{"id":"msg_1750389343354_qcf07d2hh","direction":"inbound","type":"sms","content":"hello","timestamp":"2025-06-20T03:15:43.118Z","fubLogged":false},{"id":"msg_
Parsed 8 messages from notes
   Total messages in storage: 8
   Returning 8 messages to frontend
📝 Storing incoming message in FUB notes for lead 470...
Updating notes for lead 470, size: 1520 chars
First 200 chars of notes: [EUGENIA_MESSAGES_START]{"conversations":[{"id":"msg_1750389343354_qcf07d2hh","direction":"inbound","type":"sms","content":"hello","timestamp":"2025-06-20T03:15:43.118Z","fubLogged":false},{"id":"msg_
Update response: Success
✅ Incoming message stored in FUB notes
Logging inbound SMS to FUB for lead 470: test
Successfully logged SMS to FUB: 3295
Successfully logged inbound SMS to FUB for lead 470
Eugenia status for lead 470: active
🧠 Building complete context for lead 470...
📥 Fetching messages from notes storage for lead 470...
Raw notes from FUB (first 200 chars): [EUGENIA_MESSAGES_START]{"conversations":[{"id":"msg_1750389343354_qcf07d2hh","direction":"inbound","type":"sms","content":"hello","timestamp":"2025-06-20T03:15:43.118Z","fubLogged":false},{"id":"msg_
Parsed 9 messages from notes
   Total messages in storage: 9
📚 Using FUB history: 9 messages
🎯 Final context: 9 messages for lead Test Everitt
📊 Qualification Progress: 0/3 questions answered
📊 Generating AI reply with context:
    - Lead: Test Everitt (ID: 470)
    - First Name: Test
    - Conversation Messages: 9
    - Qualification Complete: false
📝 Prompt built, length: 1617
📝 First 500 chars of prompt: You are Eugenia, an expert Inside Sales Agent (ISA) for Your Awesome Realty, a real estate company. Your goal is to qualify leads and schedule appointments with agents.

🎯 YOUR PRIMARY OBJECTIVES:
1. Build rapport and trust quickly
2. Identify their timeline and motivation
3. Understand their property needs (location, price, type)
4. Schedule a call or meeting with an agent
5. Keep responses under 160 characters for SMS

📋 LEAD INFORMATION:
- Name: Test Everitt
- Source: <unspecified>
- Tags: 
📝 Last 500 chars of prompt: es, reference them
5. Move the conversation forward toward scheduling
6. No emojis in responses

🚨 ESCALATION AWARENESS:
- This is message #10 from the lead
- After 3 messages, focus on scheduling a call
- If they mention "call", "schedule", "agent", or show buying urgency, prioritize handoff

📝 RESPONSE GUIDELINES:
- Acknowledge their message first
- Ask ONE qualifying question OR suggest next step
- Keep it natural and conversational
- Under 160 characters total

Generate Eugenia's response:
🧠 Sending prompt to Gemini...
📊 Raw result object: { hasResponse: true, resultKeys: [ 'response' ] }
📊 Response object: {
  hasText: true,
  responseKeys: [
    'candidates',
    'usageMetadata',
    'modelVersion',
    'responseId',
    'text',
    'functionCall',
    'functionCalls'
  ],
  candidates: 1
}
🔍 Candidate details: {
  finishReason: 'MAX_TOKENS',
  hasSafetyRatings: false,
  safetyRatings: undefined,
  hasContent: true,
  contentParts: 0
}
✅ Gemini response received: { responseLength: 0, firstChars: '' }
🔍 AI Generation Result: {
  hasResult: true,
  hasMessage: false,
  messageLength: 0,
  shouldPause: false,
  isQualificationComplete: false
}
⚠️ No AI message generated!
TEST LOG ENTRY
